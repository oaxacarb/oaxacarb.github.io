<!doctype html>
<html>
<head>
<meta charset='utf-8'>
<!-- Always force latest IE rendering engine or request Chrome Frame -->
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<!-- Use title if it's in the page YAML frontmatter -->
<title>Convenciones sobre la estructura de directorios en RSpec y Minitest - oaxaca.rb</title>
<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
<link href="/stylesheets/all.css" rel="stylesheet" />
<script src="/javascripts/app.js"></script>
</head>
<body class='posts posts_convenciones-sobre-la-estructura-de-directorios-en-rspec-y-minitest'>
<!-- Nav Bar -->
<div class='row' id='main'>
<!-- nav-bar small -->
<div class='sticky'>
<nav class='top-bar show-for-small' data-topbar=''>
<ul class='title-area'>
<!-- Title Area -->
<li class='name'>
<h1>
<a href='/'>
oaxacarb
</a>
</h1>
</li>
<li class='toggle-topbar menu-icon'>
<a href='#'>
menu
</a>
</li>
</ul>
<section class='top-bar-section'>
<!-- Right Nav Section -->
<ul class='right'>
<li class='divider'></li>
<li class='divider'></li>
<li>
<a href='/tags/dojo.html'>Dojos</a>
</li>
<li class='divider'></li>
<li class='divider'></li>
<li>
<a href='/tags/platica.html'>Pláticas</a>
</li>
<li class='divider'></li>
<li class='divider'></li>
<li>
<a href='/tags/evento.html'>Eventos</a>
</li>
<li class='divider'></li>
<li class='divider'></li>
<li>
<a href='/tags/trivia.html'>Trivias</a>
</li>
<li class='divider'></li>
<li class='divider'></li>
<li>
<a href='/about.html'>Acerca de</a>
</li>
<li class='divider'></li>
<li class='divider'></li>
<li>
<a href='/contacto.html'>Contacto</a>
</li>
<li class='divider'></li>
<li>
<a href='/agradecimientos.html'>Gracias</a>
</li>
</ul>
</section>
</nav>
</div>
<div class='large-12 columns'>
<div class='nav-bar right hide-for-small'>
<ul class='button-group main-menu'>
<li>
<a class='button' href='/tags/dojo.html'>Dojos</a>
</li>
<li>
<a class='button' href='/tags/platica.html'>Pláticas</a>
</li>
<li>
<a class='button' href='/tags/evento.html'>Eventos</a>
</li>
<li>
<a class='button' href='/tags/trivia.html'>Trivias</a>
</li>
<li>
<a class='button' href='/about.html'>Acerca de</a>
</li>
<li>
<a class='button' href='/contacto.html'>Contacto</a>
</li>
<li>
<a class='button' href='/agradecimientos.html'>Gracias</a>
</li>
</ul>
</div>
<a class='logo' href='/'>
<h2>
oaxaca.
<span>rb</span>
</h2>
<span>La comunidad Ruby de Oaxaca</span>
</a>
</div>

</div>
<div id='header'></div>
<!-- Main Page Content and Sidebar -->
<div class='row' id='content'>
<div class='large-9 columns' role='content'>
<article>
<h3>
<a href="/posts/convenciones-sobre-la-estructura-de-directorios-en-rspec-y-minitest.html">Convenciones sobre la estructura de directorios en RSpec y Minitest</a>
</h3>
<h6 class='datos'>Escrito el 11 de Julio de 2015</h6>
<hr>
<div class='text-justify'>

<p>Al crear un nuevo proyecto en Ruby, la estructura básica es poner el código en un directorio llamado <code>lib</code>. Además, podemos agregar un directorio <code>test</code> o <code>spec</code> para nuestros archivos de prueba. No es obligatorio, pero es una convención que deberíamos seguir, no solo porque nuestra estructura de directorios será más intuitiva, sino también porque algunos frameworks de testing así lo asumen.</p>

<p>Si queremos usar Rspec, el directorio se debe llamar <code>spec</code>. Si queremos usar Minitest, podemos nombrarlo de cualquier forma, pero es común nombrarlo <code>test</code> o también <code>spec</code>.</p>

<h2 id="rspec">RSpec</h2>

<p>Veamos un ejemplo básico con RSpec.</p>

<p>Estructura de directorios:</p>

<div class="highlight"><pre class="highlight plaintext"><code>fizz_buzz_rspec&#x000A;├── lib&#x000A;│   └── fizz_buzz.rb&#x000A;└── spec&#x000A;    └── fizz_buzz_spec.rb&#x000A;</code></pre></div>
<p>El contenido de los archivos:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="c1">#spec/fizz_buzz_spec.rb</span>&#x000A;<span class="nb">require</span> <span class="s1">'fizz_buzz'</span>&#x000A;&#x000A;<span class="n">describe</span> <span class="no">FizzBuzz</span> <span class="k">do</span>&#x000A;  <span class="n">it</span> <span class="s1">'returns "1" when receives 1'</span> <span class="k">do</span>&#x000A;    <span class="n">expect</span><span class="p">(</span><span class="no">FizzBuzz</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="s1">'1'</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;<span class="c1">#lib/fizz_buzz.rb</span>&#x000A;<span class="k">class</span> <span class="nc">FizzBuzz</span>&#x000A;  <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>&#x000A;    <span class="s1">'1'</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre></div>
<p>Es sólo la primera prueba para un proyecto fizz buzz.</p>

<p>Ahora, simplemente podemos ejecutar <code>rspec</code>:</p>

<div class="highlight"><pre class="highlight plaintext"><code>[fizz_buzz_rspec]$ rspec&#x000A;.&#x000A;&#x000A;Finished in 0.00151 seconds (files took 0.1615 seconds to load)&#x000A;1 example, 0 failures&#x000A;</code></pre></div>
<p>Estoy empezando con una prueba en verde porque el resultado no es tan verboso como si la prueba fallara, pero ya sabemos que debemos empezar una prueba en rojo, ¿cierto? ¿Cierto? :)</p>

<p>Como vemos, no necesitamos ninguna configuración extra. En nuestro archivo <code>fizz_buzz_spec</code> requerimos el archivo <code>fizz_buzz</code> y nada más. De hecho, no necesitamos requerir la biblioteca <code>rspec</code> y no necesitamos especificar dónde están nuestros archivos de prueba. Simplemente ejecutamos el comando <code>rspec</code> desde la línea de comandos dentro de nuestro proyecto y Rspec se encargó del resto.</p>

<p>¿Qué hubiera pasado si nuestro directorio <code>spec</code> fuera nombrado de manera distinta? Digamos</p>

<div class="highlight"><pre class="highlight plaintext"><code>fizz_buzz_rspec&#x000A;├── lib&#x000A;│   └── fizz_buzz.rb&#x000A;└── my_testing_directory&#x000A;    └── fizz_buzz_spec.rb&#x000A;</code></pre></div>
<p>Bien, en test caso, si ejecutamos el comando <code>rspec</code>, no se encontrará ninguna prueba para ejecutar.</p>

<div class="highlight"><pre class="highlight plaintext"><code>[fizz_buzz_rspec]$ rspec&#x000A;No examples found.&#x000A;&#x000A;&#x000A;Finished in 0.00031 seconds (files took 0.07711 seconds to load)&#x000A;0 examples, 0 failures&#x000A;</code></pre></div>
<p>Debemos ejecutar el comando indicando el directorio.</p>

<div class="highlight"><pre class="highlight plaintext"><code>[fizz_buzz_rspec]$ rspec my_testing_directory&#x000A;.&#x000A;&#x000A;Finished in 0.00151 seconds (files took 0.1615 seconds to load)&#x000A;1 example, 0 failures&#x000A;</code></pre></div>
<p>Además, es importante seguir la convención de nombres del archivo spec. RSpec espera que todos los archivos de pruebas termien con <code>_spec</code>. En nuestro caso, <code>fizz_buzz_spec.rb</code>. Si lo renombramos, RSpec no lo ejecutará. Veamos:</p>

<div class="highlight"><pre class="highlight plaintext"><code>fizz_buzz_rspec&#x000A;├── lib&#x000A;│   └── fizz_buzz.rb&#x000A;└── spec&#x000A;    └── fizz_buzz_testing_file.rb&#x000A;</code></pre></div>
<p>Intentemos ejecutar:</p>

<div class="highlight"><pre class="highlight plaintext"><code>[fizz_buzz_rspec]$ rspec&#x000A;No examples found.&#x000A;&#x000A;&#x000A;Finished in 0.00031 seconds (files took 0.07711 seconds to load)&#x000A;0 examples, 0 failures&#x000A;</code></pre></div>
<p>De nuevo, RSpec no cargó nuestro archivo porque no sigue la convención de nombrado. Si lo renombramos de nuevo <code>fizz_buzz_spec.rb</code>, funcionará.</p>

<p>Si observamos el archivo de pruebas, podemos ver que no necesitamos ninguna configuración especial para cargar el archivo <code>fizz_buzz.rb</code>, además de requerirlo claro está. RSpec asume que nuestro código está en el directorio <code>lib</code> y por eso es que puede carglo correctamente. Intentemos renombrar el directorio <code>lib</code> y veamos qué pasa.</p>

<div class="highlight"><pre class="highlight plaintext"><code>fizz_buzz_rspec&#x000A;├── main&#x000A;│   └── fizz_buzz.rb&#x000A;└── spec&#x000A;    └── fizz_buzz_spec.rb&#x000A;</code></pre></div>
<p>Si tratamos de ejecutar <code>rspec</code>.</p>

<div class="highlight"><pre class="highlight plaintext"><code>[fizz_buzz_rspec]$ rspec&#x000A;[...]core_ext/kernel_require.rb:54:in `require': cannot load such file -- fizz_buzz (LoadError)&#x000A;...&#x000A;[...]spec/fizz_buzz_spec.rb:1:in `&lt;top (required)&gt;'&#x000A;...&#x000A;</code></pre></div>
<p>Falla por el <code>require</code> (la primera línea del archivo de pruebas). No encuentra un archivo <code>fizz_buzz.rb</code>, que presupone en el directorio <code>lib</code> (que nosotros acabamos de renombrar). Así que, lo renombramos de nuevo <code>lib</code> y todo funciona de nuevo.</p>

<p>Como podemos ver, es mejor apegargse a las convenciones cuando usamos RSpec.</p>

<h3 id="spechelper"><code>spec_helper</code></h3>

<p>Es común usar un archivo <code>spec_helper</code>. Cuando nuestro proyecto crece, necesitamos incluir más bibliotecas de pruebas, o agregar más tareas para hacer antes o después de ejecutar la prueba. Por ejemplo, podríamos querer incluir <code>shoulda</code>, o limpiar la base de datos. Estas tareas afectan muchos archivos de pruebas, así que, es mejor tenerlas en su propio archivo e incluirlo en los otros archivos. Nuestro ejemplo no necesita nada más, pero quiero mostrar cómo sería si lo necesitase.</p>

<p>Digamos que queremos usar la gema <code>rspec-given</code>. Después de instarlar, necesitamos agregar esta línea al archivo <code>fizz_buzz_spec.rb</code>:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="c1">#spec/fizz_buzz_spec.rb</span>&#x000A;<span class="nb">require</span> <span class="s1">'rspec/given'</span>&#x000A;</code></pre></div>
<p>En nuestro proyecto sólo tenemos un archivo, pero si tuviéramos más, tendríamos que agregar esta línea a cada archivo de pruebas. Para evitar eso, podemos unar un <code>spec_helper</code>.</p>

<p>Primero necesitamos crear un archivo <code>spec_helper.rb</code> en nuestro directorio <code>spec</code>.</p>

<div class="highlight"><pre class="highlight plaintext"><code>fizz_buzz_rspec&#x000A;├── lib&#x000A;│   └── fizz_buzz.rb&#x000A;└── spec&#x000A;    ├── fizz_buzz_spec.rb&#x000A;    └── spec_helper.rb&#x000A;</code></pre></div>
<p>Ahora necesitamos cambiar el archivo de pruebas.</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="c1">#spec/fizz_buzz_spec.rb</span>&#x000A;<span class="nb">require</span> <span class="s1">'spec_helper'</span>&#x000A;<span class="nb">require</span> <span class="s1">'fizz_buzz'</span>&#x000A;&#x000A;<span class="n">describe</span> <span class="no">FizzBuzz</span> <span class="k">do</span>&#x000A;  <span class="no">Given</span><span class="p">(</span><span class="ss">:fizz_buzz</span><span class="p">)</span> <span class="p">{</span> <span class="no">FizzBuzz</span><span class="p">.</span><span class="nf">new</span> <span class="p">}</span>&#x000A;  <span class="no">When</span><span class="p">(</span><span class="ss">:result</span><span class="p">)</span> <span class="p">{</span> <span class="n">fizz_buzz</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>&#x000A;  <span class="no">Then</span> <span class="p">{</span> <span class="n">result</span> <span class="o">==</span> <span class="s1">'1'</span> <span class="p">}</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre></div>
<p>Si lo ejecutamos ahora, se ejecuta correctamente. No importa dónde está nuestro archivo de pruebas (por ejemplo, podría estar en <code>spec/models/inbox/fizz_buzz_spec.rb</code>), siempre podrá requerir el archivo <code>spec_helper</code> con <code>require 'spec_helper'</code>.</p>

<p>En proyectos más grandes, la ventaja de un archivo <code>spec_helper</code> es más notorio. Veamos un archivo <code>spec_helper</code> de Rails, sólo como ejemplo:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="c1">#rails_project/spec/spec_helper.rb</span>&#x000A;<span class="no">ENV</span><span class="p">[</span><span class="s2">"RAILS_ENV"</span><span class="p">]</span> <span class="o">||=</span> <span class="s1">'test'</span>&#x000A;<span class="nb">require</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s2">"../../config/environment"</span><span class="p">,</span> <span class="kp">__FILE__</span><span class="p">)</span>&#x000A;<span class="nb">require</span> <span class="s1">'rspec/rails'</span>&#x000A;<span class="nb">require</span> <span class="s1">'shoulda-matchers'</span>&#x000A;<span class="nb">require</span> <span class="s1">'rspec/autorun'</span>&#x000A;&#x000A;<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>&#x000A;  <span class="n">config</span><span class="p">.</span><span class="nf">use_transactional_fixtures</span> <span class="o">=</span> <span class="kp">true</span>&#x000A;  <span class="n">config</span><span class="p">.</span><span class="nf">order</span> <span class="o">=</span> <span class="s2">"random"</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre></div>
<p>Carga todas las bibliotecas que necesita para trabajar y configura RSpec para usar <em>fixtures</em> transaccionales y ejecutar las pruebas en orden aleatorio.</p>

<p>Nota que en esta ocasión, <code>spec_helper</code> es sólo un archivo más, puede ser nombrado de diferente manera y seguirá funcionando siempre y cuando sea requerido con el nombre correcto.</p>

<h2 id="minitest">Minitest</h2>

<p>Minitest nos permite nombrar nuestros directorios de la forma que queramos, pero necesitamos tenerlo en cuenta porque es importante cuando ejecutemos nuestras pruebas.</p>

<p>Sólo para seguir las convenciones, creé el proyecto con una estructura muy similar a la de RSpec.</p>

<div class="highlight"><pre class="highlight plaintext"><code>fizz_buzz_minitest&#x000A;├── lib&#x000A;│   └── fizz_buzz.rb&#x000A;└── test&#x000A;    └── fizz_buzz_test.rb&#x000A;</code></pre></div>
<p>El contenido de los archivos:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="c1">#test/fizz_buzz_test.rb</span>&#x000A;<span class="nb">require</span> <span class="s1">'minitest/autorun'</span>&#x000A;<span class="nb">require</span> <span class="s1">'fizz_buzz'</span>&#x000A;&#x000A;<span class="n">describe</span> <span class="no">FizzBuzz</span> <span class="k">do</span>&#x000A;  <span class="n">it</span> <span class="s1">'returns "1" when receives 1'</span> <span class="k">do</span>&#x000A;    <span class="n">assert</span> <span class="s1">'1'</span><span class="p">,</span> <span class="no">FizzBuzz</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;<span class="c1">#lib/fizz_buzz.rb</span>&#x000A;<span class="k">class</span> <span class="nc">FizzBuzz</span>&#x000A;  <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>&#x000A;    <span class="s1">'1'</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre></div>
<p>Lo primero que me gustaría señalar es que en Minitest es obligatorio requerir la bibilioteca Minitest, específicamente <code>minitest/autorun</code>, que provee de todo lo que necesitamos para ejecutar la prueba (por ejemplo, los métodos de aserciones y la capacidad de que el archivo se ejecute automáticamente). Nota que estoy usando la sintaxis <em>spec</em> aquí, pero también es posible usar la clásica sintaxis de minitest. Puedes ver un poco de las bases en el post de la <a href="/2015/05/01/kata-minitest-rompiendo-la-paralisis-inicial.html">Kata Minitest: Rompiendo la parálisis inicial</a>.</p>

<p>Ahora, tristemente, no tenemos un comando <code>minitest</code> para ejecutar, como lo teníamos con RSpec. Minitest is un framework de pruebas muy básico (pero muy poderoso). Una de sus fortalezas es que que no es un DSL como RSpec, sino Ruby puro (aunque por la sintaxis que estamos usando nostros, sí hacemos uso de un DSL). De cualquier forma, para ejecutar nuestras pruebas, solo necesitamos ejecutar Ruby.</p>

<div class="highlight"><pre class="highlight plaintext"><code>[fizz_buzz_minitest]$ ruby test/fizz_buzz_test.rb&#x000A;[...]core_ext/kernel_require.rb:54:in `require': cannot load such file -- fizz_buzz (LoadError)&#x000A;...&#x000A;        from test/fizz_buzz_test.rb:1:in `&lt;main&gt;'&#x000A;</code></pre></div>
<p>Humm, al parecer, sí ejecutó algo, pero no funcionó correctamente. Lo que pasó aquí es que no fue posible cargar el archivo <code>fizz_buzz</code>. Afortunadamente, es algo fácil de solucionar. Ruby incluye <code>require_relative</code> para requerir un archivo especificando una ruta relativa. Esta ruta debe ser construida con base en la ruta del archivo actual. En nuestro caso, nuestro archivo de pruebas está dentro de un directorio <code>test</code>, así que tenemos que indicar que nos moveremos un directorio atrás (esto se hace con dos puntos <code>..</code>) para llegar al directorio base del proyecto y entonces agregar la ruta al archivo requerido.</p>

<p>Nuestro archivo de prueba ahora se ve de esta manera:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="c1">#test/fizz_buzz_test.rb</span>&#x000A;<span class="nb">require</span> <span class="s1">'minitest/autorun'</span>&#x000A;<span class="nb">require_relative</span> <span class="s1">'../lib/fizz_buzz'</span>&#x000A;&#x000A;<span class="n">describe</span> <span class="no">FizzBuzz</span> <span class="k">do</span>&#x000A;  <span class="n">it</span> <span class="s1">'returns "1" when receives 1'</span> <span class="k">do</span>&#x000A;    <span class="n">assert</span> <span class="s1">'1'</span><span class="p">,</span> <span class="no">FizzBuzz</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre></div>
<p>Podemos ejecutar nuestras pruebas de nuevo.</p>

<div class="highlight"><pre class="highlight plaintext"><code>[fizz_buzz_minitest]$ ruby test/fizz_buzz_test.rb&#x000A;Run options: --seed 21470&#x000A;&#x000A;# Running:&#x000A;&#x000A;.&#x000A;&#x000A;Finished in 0.000718s, 1393.3787 runs/s, 1393.3787 assertions/s.&#x000A;&#x000A;1 runs, 1 assertions, 0 failures, 0 errors, 0 skips&#x000A;</code></pre></div>
<p>Ahora funciona. Nota que el comando se debe ejecutar desde el directorio base del proyecto, no desde <code>lib</code> o <code>test</code>.</p>

<p>Sin embargo, hay un pequeño problema con esta aproximación. Si reordenamos la estructura de directorios, ya sea <code>test</code> o <code>lib</code>, necesitaremos cambiar también las rutas relativas que hayamos utilizado. Por ejemplo:</p>

<div class="highlight"><pre class="highlight plaintext"><code>fizz_buzz_minitest&#x000A;├── lib&#x000A;│   └── models&#x000A;│       └── fizz_buzz.rb&#x000A;└── test&#x000A;    └── models&#x000A;        └── fizz_buzz_test.rb&#x000A;</code></pre></div>
<p>Entonces necesitamos cambiar la ruta relativa a:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require_relative</span> <span class="s1">'../../lib/models/fizz_buzz'</span>&#x000A;</code></pre></div>
<p>En nuestro ejemplo, tenemos sólo un archivo, pero en un proyecto real, esto sería un gran problema.</p>

<p>Afortunadamente, tenemos una alternativa. Podemos ejecutar nuestra archivo de pruebas especificando en la línea de comandos dónde debe Ruby buscar los archivos requeridos. Es decir, desde la línea de comandos podemos indicar que directorios deben ser precargados. Con nuestra estructua inicial, podemos ejecutar la prueba de esta manera:</p>

<div class="highlight"><pre class="highlight plaintext"><code>[fizz_buzz_minitest]$ ruby -I lib test/fizz_buzz_test.rb&#x000A;Run options: --seed 2633&#x000A;&#x000A;# Running:&#x000A;&#x000A;.&#x000A;&#x000A;Finished in 0.000820s, 1220.1178 runs/s, 1220.1178 assertions/s.&#x000A;&#x000A;1 runs, 1 assertions, 0 failures, 0 errors, 0 skips&#x000A;</code></pre></div>
<p>Usamos la opción <code>-I</code>, indicando que Ruby debe cargar de inicio el directorio <code>lib</code>.</p>

<p>Nota que con minitest, no importa cómo se nombran los directorios, simplemente funciona. Ejemplo:</p>

<div class="highlight"><pre class="highlight plaintext"><code>fizz_buzz_minitest&#x000A;├── my_own_directory&#x000A;│   └── fizz_buzz.rb&#x000A;└── my_testing_directory&#x000A;    └── fizz_buzz_test.rb&#x000A;</code></pre></div>
<p>Ejecutamos la prueba:</p>

<div class="highlight"><pre class="highlight plaintext"><code>[fizz_buzz_minitest]$ ruby -I my_own_directory test/fizz_buzz_testing_file.rb&#x000A;Run options: --seed 31542&#x000A;&#x000A;# Running:&#x000A;&#x000A;.&#x000A;&#x000A;Finished in 0.000719s, 1389.9584 runs/s, 1389.9584 assertions/s.&#x000A;&#x000A;1 runs, 1 assertions, 0 failures, 0 errors, 0 skips&#x000A;</code></pre></div>
<p>Todo funciona. Esto es porque no estamos ejecutando el conjunto completo de pruebas, como lo hacemos con RSpec. En este aso, estamos sólo ejecutando un archivo y especificamos qué directorio debe ser cargado.</p>

<h3 id="testhelper"><code>test_helper</code></h3>

<p>De la misma manera que usamos un archivo <code>spec_helper</code>, podemos usar un <code>test_helper</code> en minitest. Nota que el nombre del archivo no importa, pero <code>test_helper</code> es un nombre ampliamente usado cuando se trabaja con minitest.</p>

<p>Podemos crear un archivo <code>test_helper.rb</code> en nuestro directorio <code>test</code>.</p>

<div class="highlight"><pre class="highlight plaintext"><code>fizz_buzz_minitest&#x000A;├── lib&#x000A;│   └── fizz_buzz.rb&#x000A;└── test&#x000A;    ├── fizz_buzz_test.rb&#x000A;    └── test_helper.rb&#x000A;</code></pre></div>
<p>El contenido de nuestro <code>test_helper</code> será un poco mejor que el <code>spec_helper</code>, porque ahora podemos agregar un poco de código al menos.</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'minitest/autorun'</span>&#x000A;<span class="nb">require</span> <span class="s1">'minitest/pride'</span>&#x000A;</code></pre></div>
<p>Extrajimos el <code>rquire</code> del autorun de Minitest al <code>test_helper</code>, y además requerimos <code>pride</code>, una pequeña biblioteca de Minitest que colorea la salida.</p>

<p>Ahora necesitamos cambiar el <code>require</code> de nuestro archivo de pruebas.</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="c1">#spec/fizz_buzz_test.rb</span>&#x000A;<span class="nb">require</span> <span class="s1">'test_helper'</span>&#x000A;<span class="nb">require</span> <span class="s1">'fizz_buzz'</span>&#x000A;&#x000A;<span class="n">describe</span> <span class="no">FizzBuzz</span> <span class="k">do</span>&#x000A;  <span class="n">it</span> <span class="s1">'returns "1" when receives 1'</span> <span class="k">do</span>&#x000A;    <span class="n">assert</span> <span class="s1">'1'</span><span class="p">,</span> <span class="no">FizzBuzz</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre></div>
<p>Y tratamos de ejecutarlo:</p>

<div class="highlight"><pre class="highlight plaintext"><code>[fizz_buzz_minitest]$ ruby -I lib test/fizz_buzz_test.rb&#x000A;&#x000A;[...]core_ext/kernel_require.rb:54:in `require': cannot load such file -- test_helper (LoadError)&#x000A;...&#x000A;        from spec/fizz_buzz_test.rb:1:in `&lt;main&gt;'&#x000A;</code></pre></div>
<p>Ups, algo falló.</p>

<p>La razón es que el archivo requerido no pudo se cargado. Indicamos a Ruby que debía cargar el directorio <code>lib</code>, pero <code>test_helper</code> no está ahí, sino en el directorio <code>test</code>. Bien, para este caso, podemos usar <code>require_relative</code>, pero podemos tener el mismo problema potencial: si movemos los archivos a otros directorios, todos las rutas pasadas a <code>require_relative</code> deben ser actualizadas también.</p>

<p>De nuevo, la mejor opción es especificar que Ruby debe cargar otro directorio cuando ejecute nuestro archivo de prueba. Podemos hacerlo agregando el directorio <code>test</code> a la lista (separado por dos puntos <code>:</code>).</p>

<div class="highlight"><pre class="highlight plaintext"><code>[fizz_buzz_minitest]$ ruby -I lib:test test/fizz_buzz_test.rb&#x000A;Run options: --seed 64180&#x000A;&#x000A;# Running:&#x000A;&#x000A;.&#x000A;&#x000A;Fabulous run in 0.000797s, 1254.2865 runs/s, 1254.2865 assertions/s.&#x000A;&#x000A;1 runs, 1 assertions, 0 failures, 0 errors, 0 skips&#x000A;</code></pre></div>
<p>Y… todo funciona de nuevo.</p>

<p>Como podemos ver, Minitest no asume una estructura de directorios específica porque podemos indicar sus dependencias como opciones en línea de comandos. Sin embargo, se recomienda usar la estructura que hemos visto aquí porque es una muy difundida. Cualquier desarrollador podría imaginar dónde encontrar qué archivos y es fácil de crecer si queremos usar rake (por ejemplo) para ejecutar nuestras pruebas en lotes. Aunque esto último es un tema que dejaremos para un siguiente post.</p>

</div>
<div class='row'>
<div class='small-12 medium-4 large-4 small-centered columns blog-social'>
<ul class='inline-list'>
<li>
<a class='socialite twitter-share' data-count='vertical' data-text='Convenciones sobre la estructura de directorios en RSpec y Minitest' data-url='http://oaxacarb.org/posts/convenciones-sobre-la-estructura-de-directorios-en-rspec-y-minitest.html' href='http://twitter.com/share' rel='nofollow' target='_blank'>
<span class='vhidden'>Share on Twitter</span>
</a>
</li>
<li>
<a class='socialite googleplus-one' data-href='http://oaxacarb.org/posts/convenciones-sobre-la-estructura-de-directorios-en-rspec-y-minitest.html' data-size='tall' href='https://plus.google.com/share?url=http://oaxacarb.org/posts/convenciones-sobre-la-estructura-de-directorios-en-rspec-y-minitest.html' rel='nofollow' target='_blank'>
<span class='vhidden'>Share on Google+</span>
</a>
</li>
<li>
<a class='socialite facebook-like' data-href='http://oaxacarb.org/posts/convenciones-sobre-la-estructura-de-directorios-en-rspec-y-minitest.html' data-layout='box_count' data-send='false' data-show-faces='false' data-width='60' href='http://www.facebook.com/sharer.php?u=http://oaxacarb.org/posts/convenciones-sobre-la-estructura-de-directorios-en-rspec-y-minitest.html&amp;t=Convenciones%20sobre%20la%20estructura%20de%20directorios%20en%20RSpec%20y%20Minitest' rel='nofollow' target='_blank'>
<span class='vhidden'>Share on Facebook</span>
</a>
</li>
</ul>
</div>
</div>

<div id='disqus_thread'></div>
<script type='text/javascript'>
//<![CDATA[
                  var disqus_shortname = 'oaxacarb';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript>
<a href='http://disqus.com' class='dsq-brlink'>comments powered by <span class='logo-disqus'>Disqus</span></a>

</article>
</div>
<aside class='large-3 columns'>
<ul class='related-links'>
<li class='eventbrite'>
<a href='http://www.eventbrite.com/o/oaxacarb-6130967443' target='_blank'>
<img src="/images/eventbrite-black.png" alt="Eventbrite black" />
<span>Próximos eventos</span>
</a>
</li>
</ul>
<hr>
<ul class='related-links'>
<li class='join'>
<a href="contacto.html" title="contacto" target="_blank"><img src="/images/oaxacarb.png" alt="Oaxacarb" />
<span>Únete a la comunidad</span>
</a></li>
</ul>
<hr>
<ul class='related-links'>
<li class='slack'>
<a href='https://communityinviter.com/apps/oaxacarb/oaxacarb' target='_blank'>
<img src="/images/slack.png" alt="Slack" />
<span>Únete a nuestro Slack</span>
</a>
</li>
</ul>
<hr>
<h5>Etiquetas</h5>
<ul class='etiquetas'>
<li>
<a href="/tags/platica.html">plática</a>
</li>
<li>
<a href="/tags/evento.html">evento</a>
</li>
<li>
<a href="/tags/chatgpt.html">chatgpt</a>
</li>
<li>
<a href="/tags/programacion.html">programación</a>
</li>
<li>
<a href="/tags/empleo.html">empleo</a>
</li>
<li>
<a href="/tags/cv.html">cv</a>
</li>
<li>
<a href="/tags/remoto.html">remoto</a>
</li>
<li>
<a href="/tags/vuejs.html">vuejs</a>
</li>
<li>
<a href="/tags/javascript.html">javascript</a>
</li>
<li>
<a href="/tags/evento.html">Evento</a>
</li>
<li>
<a href="/tags/php.html">PHP</a>
</li>
<li>
<a href="/tags/drupal.html">Drupal</a>
</li>
<li>
<a href="/tags/lullabot.html">Lullabot</a>
</li>
<li>
<a href="/tags/code-retreat.html">code retreat</a>
</li>
<li>
<a href="/tags/comunidad.html">comunidad</a>
</li>
<li>
<a href="/tags/platica.html">platica</a>
</li>
<li>
<a href="/tags/elm.html">elm</a>
</li>
<li>
<a href="/tags/trivia.html">trivia</a>
</li>
<li>
<a href="/tags/vim.html">vim</a>
</li>
<li>
<a href="/tags/rails.html">rails</a>
</li>
<li>
<a href="/tags/react.html">react</a>
</li>
<li>
<a href="/tags/frontend.html">frontend</a>
</li>
<li>
<a href="/tags/ruby.html">ruby</a>
</li>
<li>
<a href="/tags/rspec.html">rspec</a>
</li>
<li>
<a href="/tags/minitest.html">minitest</a>
</li>
<li>
<a href="/tags/kata.html">kata</a>
</li>
<li>
<a href="/tags/gracias.html">gracias</a>
</li>
<li>
<a href="/tags/dojo.html">dojo</a>
</li>
<li>
<a href="/tags/recursos.html">recursos</a>
</li>
<li>
<a href="/tags/ebook.html">ebook</a>
</li>
<li>
<a href="/tags/middleman.html">middleman</a>
</li>
<li>
<a href="/tags/github.html">github</a>
</li>
<li>
<a href="/tags/rvm.html">rvm</a>
</li>
</ul>
</aside>
<!-- End Sidebar -->

</div>
<!-- Footer -->
<footer class='row'>
<div class='large-12 columns'>
<hr>
<div class='row'>
<div class='large-6 columns'>
<p>
Supported by
<a href="http://logicalbricks.com" target="_blank">LogicalBricks</a>
</p>
</div>
<div class='large-6 columns'>
<ul class='inline-list right'>
<li>
<a href='/'>Posts</a>
</li>
<li>
<a href='/tags/evento.html'>Eventos</a>
</li>
<li>
<a href='/about.html'>Acerca de</a>
</li>
<li>
<a href='/contacto.html'>Contacto</a>
</li>
</ul>
</div>
</div>
</div>
<script>
  $(document).foundation();
  
  var doc = document.documentElement;
  doc.setAttribute('data-useragent', navigator.userAgent);
</script>

</footer>
</body>
</html>
